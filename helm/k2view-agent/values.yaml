# Default values for K2view agent.

namespace:
  create: true
  name: "k2view-agent"

container:
  securityContext: true
  image:
    url: "docker.share.cloud.k2view.com/k2view/k2v-agent:2.11"
  # Pod Affinity Settings
  # These settings control the pod affinity and anti-affinity rules for the Fabric deployment.
  affinity:
    type: none # Set to "affinity" to enable pod affinity, "anti-affinity" to enable pod anti-affinity, or "none" to disable both.
    label: 
      name: topology.kubernetes.io/zone
      value: region-a

# Secrets used to configure the agent
secrets:
  K2_MAILBOX_ID: "" # Unique identifier provided by K2view to associate your site with K2cloud Orchestrator.
  K2_MANAGER_URL: "https://cloud.k2view.com/api/mailbox" # K2cloud Orchestrator URL.
  kubeInterface: "https://kubernetes.default.svc" # Kubernetes API interface, need to be accessible from the agent.
  #kubeToken: "" # If serviceAccount.create is false, this secret must be provided as secret or externalSecrets
  CLOUD: "" # Cloud provider: GCP|AWS|AZURE
  REGION: "" # Cloud region: us-east-1, us-west-1, eu-west-1, etc.
  # AWS parameters
  SPACE_SA_ARN: "" # AWS IAM role ARN for Fabric spaces, used for access to cloud resources by the Fabric spaces.
  # GCP parameters
  PROJECT: "" # GCP project ID (example: k2view-gcp-project)

# External secrets referenced to existing secrets in the namespace
externalSecrets:
  #- secretName: "keyspace_secret"
  #  key: "AWS_KEYSPACE_USER"
  #  varName: "AWS_KEYSPACE_USER"
  #- secretName: "my-secret"
  #  key: "kubeToken"
  #  varName: "kubeToken"


serviceAccount:
  # Controls the creation of Kubernetes RBAC resources for the agent.
  # When true: Creates ServiceAccount, ClusterRole, ClusterRoleBinding, and a Secret containing the service account token.
  # The agent pod will automatically use the kubeToken environment variable from this secret.
  # When false: No RBAC resources are created. You must manually provide the kubeToken secret for the agent.
  create: true
  # Attach Service Account to agent pod
  attach: false
  # The name of the service account to use
  name: "k2view-agent"
  # Bind with cloud provider IAM role (with permissions to create/delete resources in the cloud provider, optional)
  provider: ""   # Cloud provider name: aws|gcp|azure
  # AWS parameters
  arn: ""        # AWS IAM role ARN (example: arn:aws:iam::123456789012:role/K2viewAgentRole)
  # GCP parameters
  gcp_service_account_name: "" # GCP service account name (example: k2view-gcp-sa@k2view-gcp-project.iam.gserviceaccount.com)
  project_id: "" # GCP project ID (example: k2view-gcp-project)
  # Azure parameters
  azure_client_id: "" # Azure client ID (example: 12345678-9012-3456-7890-123456789012)

  # Cluster Role permissions for Service Account (if serviceAccount.create is true, role used by K2view Agent and Cloud deployer)
  role:
    rules:
      - apiGroups: [""]
        resources: ["namespaces", "services", "persistentvolumeclaims"]
        verbs: ["create", "delete", "get", "list"]
      - apiGroups: [""]
        resources: ["configmaps", "secrets", "serviceaccounts"]
        verbs: ["create", "delete", "get", "list", "patch"]
      - apiGroups: [""]
        resources: ["nodes", "pods/log"]
        verbs: ["get", "list"]
      - apiGroups: [""]
        resources: ["pods"]
        verbs: ["delete", "list", "get"]
      - apiGroups: [""]
        resources: ["events"]
        verbs: ["list"]
      - apiGroups: ["apps"]
        resources: ["deployments", "statefulsets"]
        verbs: ["create", "delete", "get", "list", "patch"]
      - apiGroups: ["batch"]
        resources: ["jobs", "jobs/status"]
        verbs: ["create", "delete", "get", "list"]
      - apiGroups: ["networking.k8s.io"]
        resources: ["ingresses", "networkpolicies"]
        verbs: ["create", "delete", "get"]
      - apiGroups: ["monitoring.coreos.com"]
        resources: ["podmonitors"]
        verbs: ["create", "delete"]
      - apiGroups: ["autoscaling"]
        resources: ["horizontalpodautoscalers"]
        verbs: ["create", "delete", "get", "list", "patch"]
      - apiGroups: [ "storage.k8s.io" ]
        resources: ["storageclasses"]
        verbs: ["get", "list"]
      - apiGroups: ["cilium.io"]
        resources: ["ciliumnetworkpolicies"]
        verbs: ["get", "list", "create", "delete"]

# Add custom certificates into K2view Agent's container.
# It should be in pem format, with header and footer, one certificate per key
#customCACerts:
#  company-rootca-1.crt: |
#    -----BEGIN CERTIFICATE-----
#    MII...
#    -----END CERTIFICATE-----
#  company-rootca-2.cer: |
#    -----BEGIN CERTIFICATE-----
#    MII...
#    -----END CERTIFICATE-----
